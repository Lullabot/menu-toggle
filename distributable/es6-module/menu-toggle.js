"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.menuToggleInit=exports.menuToggleToggleState=exports.menuToggleOpen=exports.menuToggleBackOut=exports.menuToggleShut=exports.menuToggleAdjustMenuAndPageHeights=void 0;var _events=require("./events"),_polyfill=require("./polyfill");(0,_polyfill.closest)(),document.querySelector("body").dataset.menuToggleLastOpenToggleTarget="";var menuToggleAdjustMenuAndPageHeights=function(e){var t=document.querySelector(".body-inner");if(e.classList.contains("menu-toggle__toggleable--full-height"))e.style.setProperty("height","".concat(window.innerHeight-e.getBoundingClientRect().top,"px")),t.style.setProperty("min-height",window.innerHeight),document.getElementsByTagName("body")[0].classList.add("u-body-no-scroll");else{var n=e.querySelector(".menu-toggle__toggleable-content-wrapper").offsetHeight,o=n+e.getBoundingClientRect().top;e.style.setProperty("height","".concat(n,"px")),t.style.setProperty("min-height","".concat(o,"px"))}};exports.menuToggleAdjustMenuAndPageHeights=menuToggleAdjustMenuAndPageHeights;var menuToggleShut=function e(t,n,o){var g=document.querySelector("body");document.querySelector(".body-inner").style.removeProperty("min-height"),t.setAttribute("aria-expanded","false"),t.classList.remove("js-menu-toggle-button--active"),document.getElementsByTagName("body")[0].classList.remove("u-body-no-scroll"),n.classList.contains("menu-toggle__toggleable--full-height")||n.style.setProperty("height","0"),n.classList.remove("js-menu-toggle__toggleable--open"),n.getAttribute("id")===g.dataset.menuToggleLastOpenToggleTarget&&n.dataset.parentMenuToggle&&(g.dataset.menuToggleLastOpenToggleTarget="");var l=document.getElementById(n.dataset.parentMenuToggle);l&&l.classList.remove("js-menu-toggle__toggleable--active-child","js-menu-toggle__toggleable--active-child--transitioned"),t.classList.remove("js-menu-toggle-button--active"),n.classList.remove("js-menu-toggle__toggleable--open");var a=n.querySelectorAll(".js-menu-toggle-button--active");if(a.length)for(var s=0;s<a.length;s++)setTimeout(e(a[s],document.getElementById(a[s].getAttribute("aria-controls")),o),0);t.focus(),"function"==typeof o&&o(t,n,l)};exports.menuToggleShut=menuToggleShut;var menuToggleBackOut=function(e){if("BODY"!==document.activeElement.tagName){var t=document.activeElement.closest(".js-menu-toggle__toggleable--open");if(t){var n=document.querySelector('[aria-controls="'.concat(t.getAttribute("id"),'"]'));return void menuToggleShut(n,t,e)}}var o=document.querySelector("body");if(o.dataset.menuToggleLastOpenToggleTarget&&""!==o.dataset.menuToggleLastOpenToggleTarget){var g=document.getElementById(o.dataset.menuToggleLastOpenToggleTarget);if(g){var l=document.querySelector('[aria-controls="'.concat(o.dataset.menuToggleLastOpenToggleTarget,'"]'));return void menuToggleShut(l,g,e)}}};exports.menuToggleBackOut=menuToggleBackOut;var menuToggleOpen=function(e,t,n,o){var g=document.querySelector("body"),l=e.getAttribute("aria-controls");g.dataset.menuToggleLastOpenToggleTarget&&g.dataset.menuToggleLastOpenToggleTarget!==l&&(document.getElementById(g.dataset.menuToggleLastOpenToggleTarget).contains(document.getElementById(l))||menuToggleBackOut(o));menuToggleAdjustMenuAndPageHeights(t),e.setAttribute("aria-expanded","true"),e.classList.add("js-menu-toggle-button--active"),t.classList.add("js-menu-toggle__toggleable--open");var a=document.getElementById(t.dataset.parentMenuToggle);a&&a.classList.add("js-menu-toggle__toggleable--active-child"),g.dataset.menuToggleLastOpenToggleTarget=l,"function"==typeof n&&n(e,t,a)};exports.menuToggleOpen=menuToggleOpen;var menuToggleToggleState=function(e,t,n,o){t.classList.toggle("js-menu-toggle__toggleable--open"),t.classList.contains("js-menu-toggle__toggleable--open")?menuToggleOpen(e,t,n,o):menuToggleShut(e,t,o)};exports.menuToggleToggleState=menuToggleToggleState;var menuToggleInit=function(n,e,t,o,g,l){if("BUTTON"!==n.tagName||!n.classList.contains("js-menu-toggle-button")){var a=n.dataset.controls,s=document.getElementById(a),u=document.querySelector("body");if("LABEL"===n.tagName){var r=n.getAttribute("for"),i=document.getElementById(r),c=document.createElement("button");c.innerHTML=n.innerHTML,n.getAttribute("class").split(" ").forEach(function(e){(e=e.replace(/^\s+|\s+$/g,"")).length&&c.classList.add(e)}),c.setAttribute("aria-controls",n.getAttribute("data-controls")),c.setAttribute("id",r),c.setAttribute("aria-haspopup","true"),c.setAttribute("aria-expanded","false"),i.remove(),n.parentNode.replaceChild(c,n),n=c}n.classList.add("js-menu-toggle-button"),"none"!==getComputedStyle(n).display&&s.classList.add("js-menu-toggle__toggleable");var d=s.parentElement.closest(".menu-toggle__toggleable");null!==d&&(s.dataset.parentMenuToggle=d.getAttribute("id")),n.addEventListener("click",function(){menuToggleToggleState(n,s,g,l)});if("function"==typeof t?n.addEventListener("keydown",t):n.addEventListener("keydown",function(e){var t=e.which;39===t?(e.preventDefault(),e.stopPropagation(),menuToggleOpen(n,s,g,l)):37===t?(e.preventDefault(),e.stopPropagation(),menuToggleShut(n,s,l)):40===t?(e.preventDefault(),e.stopPropagation(),menuToggleOpen(n,s,g,l)):38===t?(e.preventDefault(),e.stopPropagation(),menuToggleShut(n,s,l)):27===t?(e.preventDefault(),e.stopPropagation(),menuToggleShut(n,s,l)):13!==t&&32!==t||(e.preventDefault(),e.stopPropagation(),menuToggleToggleState(n,s,g,l))}),"function"==typeof o?s.addEventListener("keydown",o):s.addEventListener("keydown",function(e){var t=e.target;27===e.which&&(e.preventDefault(),e.stopPropagation(),"BUTTON"===t.tagName||t.classList.contains("js-menu-toggle-button")||menuToggleBackOut(l))}),s.classList.contains("menu-toggle__toggleable--with-close")){var m=document.createElement("button");m.classList.add("js-menu-toggle__toggleable__close"),m.setAttribute("aria-controls",a),m.innerHTML='<span class="element-invisible">Close</span>',m.addEventListener("click",function(){menuToggleShut(n,s,l)}),s.appendChild(m)}s.addEventListener("transitioned",function(){if("none"!==getComputedStyle(n).display)if(s.classList.contains("js-menu-toggle__toggleable--open")){var e=document.getElementById(s.dataset.parentMenuToggle);e&&e.classList.add("js-menu-toggle__toggleable--active-child--transitioned"),!s.classList.contains("menu-toggle__toggleable--full-height")&&s.querySelector(".menu-toggle__toggleable-content-wrapper").offsetHeight<s.offsetHeight&&menuToggleAdjustMenuAndPageHeights(s)}else s.classList.remove("js-menu-toggle__toggleable--active-child"),0!==s.scrollTop&&(s.scrollTop=0),0!==s.scrollLeft&&(s.scrollLeft=0)}),_events.resize.add(function(){var e=getComputedStyle(n).display;"none"===e&&s.classList.contains("js-menu-toggle__toggleable")?s.classList.remove("js-menu-toggle__toggleable"):"none"===e||s.classList.contains("js-menu-toggle__toggleable")||s.classList.add("js-menu-toggle__toggleable"),u.dataset.menuToggleLastOpenToggleTarget&&menuToggleAdjustMenuAndPageHeights(document.getElementById(u.dataset.menuToggleLastOpenToggleTarget))}),"function"==typeof e&&e(n,s,menuToggleOpen,menuToggleShut)}};exports.menuToggleInit=menuToggleInit;